# 税務書類リネームシステム インストールガイド 🚀

## 目次
1. [システム要件](#システム要件)
2. [必須インストール物](#必須インストール物)
3. [インストール手順](#インストール手順)
4. [動作確認方法](#動作確認方法)
5. [トラブルシューティング](#トラブルシューティング)

---

## システム要件

### 💻 基本要件
- **OS**: Windows 10 以上（推奨：Windows 11）
- **メモリ**: 最低4GB（推奨：8GB以上）
- **ストレージ**: 最低2GB の空き容量
- **CPU**: Intel Core i3 以上または同等のAMD CPU

### 🐍 Python要件
- **Python バージョン**: 3.7 以上（**推奨：3.8〜3.11**）
- **パッケージ管理**: pip（Pythonに同梱）

---

## 必須インストール物

### 🔧 1. 外部ツール（手動インストール必要）

#### **Tesseract OCR** ⭐ 最重要
- **用途**: 画像からテキストを読み取るOCRエンジン
- **バージョン**: 5.x 系最新版推奨
- **ダウンロード先**: 
  - Windows: https://github.com/UB-Mannheim/tesseract/wiki
  - 直接リンク: https://digi.bib.uni-mannheim.de/tesseract/
- **重要設定**:
  - **日本語言語パック**が必要（`jpn.traineddata`）
  - **PATH環境変数**に追加が必要
  - インストール先例: `C:\Program Files\Tesseract-OCR\`

#### **Poppler** ⭐ 重要
- **用途**: PDF処理（PDF→画像変換）
- **ダウンロード先**: 
  - Windows: http://blog.alivate.com.au/poppler-windows/
  - または: https://github.com/oschwartz10612/poppler-windows
- **重要設定**:
  - **PATH環境変数**に追加が必要
  - `pdfimages.exe`コマンドが使用可能である必要
  - インストール先例: `C:\Program Files\poppler\bin\`

#### **Visual C++ Redistributable**
- **用途**: OpenCVライブラリの動作に必要
- **ダウンロード先**: Microsoft公式サイト
- **バージョン**: 最新版（Visual Studio 2015-2022用）

---

### 📦 2. Pythonパッケージ（自動インストール可能）

#### **必須パッケージ一覧**
```bash
# OCR関連
pytesseract>=3.0.0      # Tesseract OCRのPythonラッパー
easyocr>=1.6.0          # 代替OCRエンジン（オプション）

# PDF・画像処理
pdf2image>=1.16.0       # PDFページを画像に変換
Pillow>=8.0.0           # 画像処理ライブラリ（PIL）
opencv-python>=4.5.0    # 画像前処理（OpenCV）
PyPDF2>=2.0.0           # PDF操作・メタデータ読取

# 数値計算・データ処理
numpy>=1.20.0           # 数値計算と画像データ操作

# GUI（通常Pythonに同梱）
tkinter                 # Python標準GUI
pathlib                 # ファイルパス操作

# オプション（高機能版に必要）
python-docx>=0.8.11     # Word文書出力用
openpyxl>=3.0.0         # Excel出力用
```

---

## インストール手順

### 🚀 STEP 1: Python環境の確認

#### 1-1. Pythonインストール確認
```cmd
python --version
```
**期待する結果**: `Python 3.8.x` 以上が表示される

#### 1-2. pipの確認
```cmd
pip --version
```
**期待する結果**: pip のバージョンが表示される

---

### 🔧 STEP 2: 外部ツールのインストール

#### 2-1. Tesseract OCRのインストール

1. **ダウンロード**
   - https://github.com/UB-Mannheim/tesseract/wiki にアクセス
   - Windows用インストーラーをダウンロード
   - 推奨: `tesseract-ocr-w64-setup-v5.3.0.20221214.exe`（最新版）

2. **インストール実行**
   ```
   インストール先: C:\Program Files\Tesseract-OCR\
   
   ⚠️ 重要：インストール時に以下にチェックを入れる
   ✅ Additional language data
   ✅ Japanese (jpn)
   ```

3. **PATH環境変数の設定**
   - Windows検索で「環境変数」を検索
   - 「システム環境変数の編集」を開く
   - 「環境変数」ボタンをクリック
   - 「システム環境変数」の「Path」を選択して「編集」
   - 「新規」をクリックして以下を追加:
     ```
     C:\Program Files\Tesseract-OCR\
     ```

4. **動作確認**
   - コマンドプロンプトを**新しく開いて**以下を実行:
   ```cmd
   tesseract --version
   ```
   **期待する結果**: Tesseractのバージョン情報が表示される

#### 2-2. Popplerのインストール

1. **ダウンロード**
   - http://blog.alivate.com.au/poppler-windows/ にアクセス
   - 最新版のZIPファイルをダウンロード
   - 例: `poppler-22.04.0_x86_64.zip`

2. **展開とインストール**
   ```
   展開先: C:\Program Files\poppler\
   
   フォルダ構成例:
   C:\Program Files\poppler\
   ├── bin\          ← 実行ファイル群
   │   ├── pdfimages.exe
   │   ├── pdfinfo.exe
   │   └── ...
   ├── include\
   └── lib\
   ```

3. **PATH環境変数の設定**
   - Tesseractと同様の手順で以下を追加:
     ```
     C:\Program Files\poppler\bin\
     ```

4. **動作確認**
   ```cmd
   pdfimages -v
   ```
   **期待する結果**: pdfimagesのバージョン情報が表示される

#### 2-3. Visual C++ Redistributableのインストール

1. **ダウンロード**
   - Microsoft公式サイトから最新版をダウンロード
   - 検索: "Visual C++ Redistributable 2022"

2. **インストール**
   - ダウンロードした .exe ファイルを実行
   - 指示に従ってインストール

---

### 📦 STEP 3: Pythonパッケージのインストール

#### 3-1. 一括インストール（推奨）

**コマンドプロンプトまたはPowerShellで実行:**
```cmd
pip install pytesseract pdf2image Pillow opencv-python PyPDF2 numpy
```

#### 3-2. 個別インストール（問題が発生した場合）
```cmd
pip install pytesseract>=3.0.0
pip install pdf2image>=1.16.0  
pip install Pillow>=8.0.0
pip install opencv-python>=4.5.0
pip install PyPDF2>=2.0.0
pip install numpy>=1.20.0
```

#### 3-3. オプションパッケージ
```cmd
# Word・Excel出力が必要な場合
pip install python-docx openpyxl

# 代替OCRエンジンが必要な場合  
pip install easyocr
```

---

### 🎯 STEP 4: 税務書類リネームシステムの取得

#### 4-1. GitHubからダウンロード
```cmd
# Git使用の場合
git clone https://github.com/Ezark213/tax-doc-renamer.git

# または、GitHubのWebページからZIPダウンロード
```

#### 4-2. システムファイルの配置
```
推奨配置場所: C:\tax-doc-renamer\
または: C:\Users\[ユーザー名]\tax-doc-renamer\
```

---

## 動作確認方法

### ✅ 1. 外部ツールの動作確認

#### Tesseract確認
```cmd
tesseract --version
tesseract --list-langs
```
**期待する結果**: 
- バージョン情報の表示
- 言語リストに `jpn` が含まれる

#### Poppler確認  
```cmd
pdfimages -v
pdfinfo -v
```
**期待する結果**: 各コマンドのバージョン情報が表示される

### ✅ 2. Pythonパッケージの動作確認

#### 簡単なテストスクリプト
```python
# test_installation.py として保存
import sys
print(f"Python version: {sys.version}")

try:
    import pytesseract
    print("✅ pytesseract: OK")
except ImportError:
    print("❌ pytesseract: NG")

try:
    import pdf2image
    print("✅ pdf2image: OK")
except ImportError:
    print("❌ pdf2image: NG")

try:
    from PIL import Image
    print("✅ Pillow: OK")
except ImportError:
    print("❌ Pillow: NG")

try:
    import cv2
    print("✅ OpenCV: OK")
except ImportError:
    print("❌ OpenCV: NG")

try:
    import PyPDF2
    print("✅ PyPDF2: OK")
except ImportError:
    print("❌ PyPDF2: NG")

try:
    import numpy
    print("✅ NumPy: OK")
except ImportError:
    print("❌ NumPy: NG")

# OCRテスト（Tesseract）
try:
    from PIL import Image
    import pytesseract
    
    # テスト用の小さな画像でOCRテスト
    test_img = Image.new('RGB', (100, 50), color='white')
    result = pytesseract.image_to_string(test_img, lang='jpn')
    print("✅ OCR (Japanese): OK")
except Exception as e:
    print(f"❌ OCR (Japanese): NG - {e}")
```

#### テスト実行
```cmd
python test_installation.py
```

---

## トラブルシューティング

### 🚨 よくある問題と解決方法

#### 問題1: 「tesseract」が認識されない
**エラー**: `'tesseract' は、内部コマンドまたは外部コマンド...として認識されていません`

**解決方法**:
1. PATH環境変数にTesseractのパスが追加されているか確認
2. コマンドプロンプトを**再起動**
3. インストール先パスが正しいか確認:
   ```cmd
   dir "C:\Program Files\Tesseract-OCR\"
   ```

#### 問題2: 日本語OCRが動作しない
**エラー**: 日本語テキストが認識されない

**解決方法**:
1. 日本語言語パックの確認:
   ```cmd
   tesseract --list-langs
   ```
   リストに `jpn` があるか確認

2. 言語パックが無い場合:
   - Tesseractを**再インストール**
   - インストール時に「Japanese (jpn)」にチェックを入れる

#### 問題3: PDFが処理できない
**エラー**: PDF→画像変換でエラー

**解決方法**:
1. Popplerの動作確認:
   ```cmd
   pdfinfo -v
   ```

2. PATH設定の確認:
   - `C:\Program Files\poppler\bin\` がPATHに追加されているか確認

#### 問題4: OpenCVインストールエラー
**エラー**: `opencv-python` のインストールに失敗

**解決方法**:
1. Visual C++ Redistributableのインストール確認
2. 管理者権限でコマンドプロンプトを開いて再実行:
   ```cmd
   pip install --upgrade pip
   pip install opencv-python
   ```

#### 問題5: メモリ不足エラー
**エラー**: OCR処理中にメモリエラー

**解決方法**:
1. **大きなPDFファイルは分割**して処理
2. **他のアプリケーションを終了**してメモリを確保
3. システムの**仮想メモリを増加**

#### 問題6: 権限エラー
**エラー**: ファイルの読み書きで権限エラー

**解決方法**:
1. **管理者権限**でアプリケーションを実行
2. ウイルス対策ソフトの**除外設定**に追加
3. フォルダの**アクセス権限**を確認

---

## 📋 インストール完了チェックリスト

### ✅ 外部ツール
- [ ] Python 3.7以上がインストール済み
- [ ] Tesseract OCR がインストール済み
- [ ] 日本語言語パック（jpn）がインストール済み
- [ ] Poppler がインストール済み  
- [ ] Visual C++ Redistributable がインストール済み
- [ ] PATH環境変数が正しく設定済み

### ✅ Pythonパッケージ
- [ ] pytesseract がインストール済み
- [ ] pdf2image がインストール済み
- [ ] Pillow がインストール済み
- [ ] opencv-python がインストール済み
- [ ] PyPDF2 がインストール済み
- [ ] numpy がインストール済み

### ✅ 動作確認
- [ ] `tesseract --version` でバージョン表示
- [ ] `tesseract --list-langs` で jpn が表示  
- [ ] `pdfimages -v` でバージョン表示
- [ ] Python テストスクリプトが全て OK
- [ ] 実際のPDFファイルでテスト実行成功

---

## 📞 サポート情報

### 🆘 困ったときの連絡先
- **GitHub Issues**: https://github.com/Ezark213/tax-doc-renamer/issues
- **システム作成者**: Ezark213

### 📚 参考資料
- **Tesseract公式**: https://github.com/tesseract-ocr/tesseract
- **Poppler公式**: https://poppler.freedesktop.org/
- **Python公式**: https://www.python.org/

### 🔄 システム更新方法
```cmd
# GitHubから最新版を取得
git pull origin main

# または、最新ZIPをダウンロードして上書き
```

---

**📅 更新日**: 2025年8月26日  
**🏷️ バージョン**: v4.0対応  
**👨‍💻 作成者**: 税務書類リネームシステム サポートチーム

このガイドに従ってインストールすれば、税務書類リネームシステムが正常に動作するはずです！
何か問題が発生した場合は、エラーメッセージを正確にコピーして、上記のトラブルシューティングを参照してください。