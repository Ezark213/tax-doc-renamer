# 税務書類リネームシステム v5.0 修正版

**税務書類の自動分類・リネームシステム（番号体系バグ修正版）**

## 🚀 最新版: v5.0 Fixed（緊急修正版）

**重要**: Phase 1緊急修正が完了しました。番号体系の根本的バグを修正し、正常なファイル名生成を実現。

### ✅ 修正内容
- **異常番号の修正**: `10011_消費税申告書` → `3001_消費税申告書`
- **セット連番の正規化**: 基本番号 + (セット番号-1)×10の正しい計算
- **分類エンジン完全修正**: classification_v5_fixed.py実装

## ✨ システム概要

- **自動分割・リネーム**: 複数ページPDFを書類種別ごとに自動分割してリネーム
- **文書判定方式リネーム**: 単一PDFファイルの内容を分析してリネーム
- **複数自治体対応**: 最大5つの都道府県・市町村への提出に対応
- **空白ページ除外**: 不要ページの自動検出・除外
- **番号体系管理**: 統一された4桁番号による分類システム

### 📁 ディレクトリ構成
```
tax-doc-renamer/
├── README.md           # このファイル  
├── requirements.txt    # Python依存関係
├── v4.0/              # ★ 最新版v5.0システム（使用推奨）
│   ├── README_v5.md   # v5.0セットアップガイド
│   ├── main_v5.py     # v5.0メインアプリ
│   ├── core/          # v5.0コアモジュール
│   │   └── classification_v5.py  # AND条件対応分類エンジン
│   ├── TaxDocRenamer_v5.0_Distribution/  # 配布パッケージ
│   ├── TaxDocRenamer_v5.0_Installer/     # インストーラー版
│   └── TaxDocRenamer_v5.0_Portable/      # ポータブル版
└── old/               # 古いバージョン（参考用）
```

## ✨ v5.0 新機能
- **🎯 AND条件対応**: 複数キーワードの同時マッチング判定
- **🏷️ 簡潔命名**: 税種別接尾辞を削除（0003_受信通知、3004_納付情報等）
- **📍 汎用自治体対応**: 大阪府大阪市、大分県大分市等にも対応
- **🧠 高精度分類**: 最優先AND条件による誤分類防止
- **🔧 拡張性向上**: 新しい都道府県・市町村の簡単追加
- **🎉 Tesseract同梱版**: 外部インストール不要の実行ファイル版を提供

## 🚀 配布版（推奨）

### Portable版（単一実行ファイル）
```
v4.0/TaxDocRenamer_v5.0_Portable/
├── TaxDocRenamer_v5.0.exe  # 実行ファイル（Tesseract同梱）
├── README_PORTABLE.txt     # Portable版専用ガイド
└── 運用ガイド.md          # 詳細運用マニュアル
```

### Installer版（システムインストール）
```
v4.0/TaxDocRenamer_v5.0_Installer/
├── app/                    # アプリケーションファイル群
├── install.bat             # インストーラー（要管理者権限）
├── uninstall.bat           # アンインストーラー
└── インストール手順.txt    # インストール手順
```

### macOS版
```
v4.0/TaxDocRenamer_v5.0_macOS_*/
├── TaxDocRenamer_v5.0_*    # 実行ファイル（Intel/AppleSilicon別）
├── run.sh                  # Gatekeeper対応起動スクリプト
└── README_macOS.txt        # macOS版専用ガイド
```

## 🔧 配布ポリシー変更のお知らせ

**v5.0から外部依存関係を解決しました：**

### 変更前（v4.0以前）
- ❌ Python 3.8以上のインストールが必要
- ❌ Tesseract OCRの手動インストールが必要
- ❌ pip install -r requirements.txt の実行が必要

### 変更後（v5.0）
- ✅ **Tesseract OCR同梱** - 外部インストール不要
- ✅ **実行ファイル版提供** - Python環境不要
- ✅ **依存関係解決済み** - 追加セットアップ不要

## 🎯 システム要件

### 手入力項目要件
- **自治体情報入力**: 最大5か所まで入力可能な都道府県・市町村セット（全て任意）
  - セット1：都道府県名 + 市町村名（任意）
  - セット2〜5：同様の構成
- **年月(YYMM形式)**: 対象年月を4桁で入力（例：2025年6月→2506）
- **東京都制約**: 東京都が入力されている場合は必ず1番目（セット1）に配置
- **連番規則**: 実際に入力された順番通りに連番を付与

### 入力制約
- **必須入力**: なし（全ての項目が任意入力）
- **柔軟対応**: 東京都のみ、単一県市のみの入力も可能
- **エラー処理**: 東京都位置エラー時は「東京都は1番目に入力してください」表示

## 🛠️ クイックスタート

### 1. ポータブル版（推奨）
```bash
cd v4.0/TaxDocRenamer_v5.0_Portable
./TaxDocRenamer_v5.0.exe
```

### 2. Python環境で実行
```bash
cd v4.0
python main_v5.py
```

### 3. インストーラー版
```bash
cd v4.0/TaxDocRenamer_v5.0_Installer
./install.bat
```

## 📖 詳細セットアップ
詳しいセットアップ手順は以下をご覧ください：
- `v4.0/README_v5.md` - v5.0システム概要
- `v4.0/V5_運用ガイド.md` - 運用ガイド

## 🎯 v5.0の書類分類システム

### 番号体系の基本
ファイル命名規則: `XXXX_書類名_YYMM.pdf`
- XXXX: 4桁の分類番号
- 書類名: 書類種別に応じた名称
- YYMM: 年月（例：2508 = 2025年8月）

### 基本コード体系

| 番号帯 | 分類 | 例 | 説明 |
|--------|------|----|----|
| 0000-0999 | 国税申告書類 | 0001, 0003 | 法人税・消費税以外の国税 |
| 1000-1999 | 都道府県税 | 1001, 1011 | 都道府県民税・事業税など |
| 2000-2999 | 市町村税 | 2001, 2011 | 市民税・住民税など |
| 3000-3999 | 消費税 | 3001, 3003 | 消費税・地方消費税 |
| 5000-5999 | 会計書類 | 5001, 5002 | 決算書・元帳など |
| 6000-6999 | 固定資産 | 6001, 6002 | 固定資産台帳など |
| 7000-7999 | 税区分 | 7001, 7002 | 税区分集計表 |
| 9999 | 未分類 | 9999 | 分類できなかった書類 |

### リネーム例（主要書類）

#### 国税関連（0000番台）
- `0000_納付税額一覧表_2508.pdf` - 各種税金の納付金額一覧表
- `0001_法人税及び地方法人税申告書_2508.pdf` - 法人税申告書本体
- `0002_添付資料_2508.pdf` - 法人税関連添付資料
- `0003_受信通知_2508.pdf` - 法人税申告受信通知
- `0004_納付情報_2508.pdf` - 法人税・地方法人税納付情報

#### 都道府県税（1000番台）
- `1001_東京都_法人都道府県民税・事業税・特別法人事業税_2508.pdf` - 1番目都道府県
- `1011_愛知県_法人都道府県民税・事業税・特別法人事業税_2508.pdf` - 2番目都道府県
- `1003_受信通知_2508.pdf` - 都道府県税受信通知
- `1004_納付情報_2508.pdf` - 法人二税・特別税納付情報

#### 市町村税（2000番台）
- `2001_愛知県蒲郡市_法人市民税_2508.pdf` - 1番目市町村
- `2011_福岡県福岡市_法人市民税_2508.pdf` - 2番目市町村
- `2003_受信通知_2508.pdf` - 1番目市町村受信通知
- `2013_受信通知_2508.pdf` - 2番目市町村受信通知

#### 消費税（3000番台）
- `3001_消費税及び地方消費税申告書_2508.pdf` - 消費税申告書本体
- `3002_添付資料_2508.pdf` - 消費税関連添付資料
- `3003_受信通知_2508.pdf` - 消費税申告受信通知
- `3004_納付情報_2508.pdf` - 消費税・地方消費税納付情報

## 🔧 システム要件

### 配布版（推奨）
- **OS**: Windows 10/11, macOS 10.14以降
- **メモリ**: 4GB以上推奨
- **ストレージ**: 200MB以上の空き容量
- **外部依存関係**: なし（全て同梱済み）

### Python開発版（開発者向け）
- Python 3.8以上
- ~~Tesseract OCR~~（同梱版を使用）
- pip install -r requirements.txt

## 🌍 対応自治体（拡張例）
現在対応済み：
- セット1: 東京都
- セット2: 愛知県蒲郡市  
- セット3: 福岡県福岡市

簡単に追加可能：
- 大阪府大阪市
- 大分県大分市
- 北海道札幌市
- 神奈川県横浜市

## 📞 サポート
- GitHub Issues: [税務書類リネームシステム Issues](https://github.com/Ezark213/tax-doc-renamer/issues)
- 最新版確認: `git pull origin main`

---
**注意**: 古いバージョン（v1.0-v4.0等）は `old/` フォルダに移動済みです。  
現在は **v5.0システム** のみをご使用ください。

🤖 Generated with [Claude Code](https://claude.ai/code)