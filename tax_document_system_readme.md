# 税務書類画像認識・分割・リネームシステム

税務署へ提出する各種申告書類のPDFを画像認識により自動分割し、書類種別に応じた統一ファイル名で自動リネームするシステム

## 📋 概要

本システムは、企業の税務申告業務における書類管理を効率化することを目的としており、複数ページのPDFファイルから各種税務書類を自動で識別・分割し、統一されたファイル名規則に従ってリネームします。

## ✨ 主要機能

### 🏛️ 自治体情報管理
- 最大5か所の自治体（都道府県・市町村）に対応
- 東京都の特別扱い（市町村入力不要）
- 入力順序による自動連番付与

### 📄 自動処理機能
- **自動分割・リネーム**: 複数ページPDFからの書類自動識別
- **トリガー方式**: キーワード検出による単一PDF処理
- **空白ページ除外**: 不要ページの自動検出・除外

### 📊 対応書類種別
- 地方税関連書類（申告受付完了通知、納付情報等）
- 国税関連書類（消費税・法人税申告書、納付区分番号通知等）
- 会計書類（決算書、総勘定元帳、仕訳帳等）
- 固定資産関連書類（固定資産台帳、償却資産明細等）

## 🚀 インストール

```bash
# リポジトリのクローン
git clone https://github.com/Earrk213/tax-doc-renamer.git
cd tax-doc-renamer

# 依存関係のインストール
npm install
# または
pip install -r requirements.txt
```

## 💻 使用方法

### 基本的な使用手順

1. **自治体情報の入力**
   ```
   セット1: 東京都 (市町村名は不要)
   セット2: 大阪府 大阪市
   セット3: 愛知県 名古屋市
   ```

2. **年月の入力**
   ```
   YYMM形式: 2506 (2025年6月)
   ```

3. **PDFファイルのアップロード**
   - 複数ページPDF（自動分割処理）
   - 単一PDF（トリガー方式処理）

4. **処理実行**
   - 自動で書類種別を判定
   - 統一ファイル名でリネーム

### 入力例

#### 複数自治体への提出
```
セット1: 東京都 → 1001_東京都_法人都道府県民税・事業税・特別法人事業税_2506.pdf
セット2: 福岡県 福岡市 → 1011_福岡県_法人都道府県民税・事業税・特別法人事業税_2506.pdf
                     2001_福岡県福岡市_法人市民税_2506.pdf
```

#### 単一自治体（東京都のみ）
```
セット1: 東京都 → 1001_東京都_法人都道府県民税・事業税・特別法人事業税_2506.pdf
```

## 📝 ファイル命名規則

### 番号体系

| 番号帯 | 分類 | 例 |
|--------|------|-----|
| 0000番台 | 申告書類 | 0001_法人税及び地方法人税申告書_YYMM.pdf |
| 1000番台 | 都道府県関連 | 1001_東京都_法人都道府県民税・事業税・特別法人事業税_YYMM.pdf |
| 2000番台 | 市町村関連 | 2001_大阪府大阪市_法人市民税_YYMM.pdf |
| 3000番台 | 消費税関連 | 3001_消費税及び地方消費税申告書_YYMM.pdf |
| 5000番台 | 会計書類 | 5001_決算書_YYMM.pdf |
| 6000番台 | 固定資産関連 | 6001_固定資産台帳_YYMM.pdf |
| 7000番台 | 税区分関連 | 7001_勘定科目別税区分集計表_YYMM.pdf |

### 連番規則

- **都道府県**: 1001 → 1011 → 1021 → 1031 → 1041
- **市町村申告書**: 2001 → 2011 → 2021 → 2031 → 2041
- **市町村受信通知**: 2003 → 2013 → 2023 → 2033 → 2043

## 🔍 判定キーワード

### 地方税関連
| 書類種別 | 判定キーワード |
|----------|----------------|
| 申告受付完了通知（都道府県） | "法人都道府県民税・事業税・特別法人事業税又は地方法人特別税 確定申告" |
| 申告受付完了通知（市町村） | "法人市町村民税 確定申告" |

### 国税関連
| 書類種別 | 判定キーワード |
|----------|----------------|
| 消費税申告受信通知 | "種目 消費税申告書" |
| 法人税申告受信通知 | "種目 法人税及び地方法人税申告書" |

### 申告書類
| 書類種別 | 判定キーワード |
|----------|----------------|
| 法人税申告書 | "事業年度分の法人税申告書", "課税事業年度分の地方法人税申告書" |
| 消費税申告書 | "この申告書による消費税の税額の計算" |
| 都道府県民税申告書 | "付加価値額総額", "資本金等の額総額" |

## ⚙️ 設定

### 空白ページ除外設定
```json
{
  "blankPageThreshold": 100,
  "excludePatterns": [
    "メッセージ Page X of Y",
    "ページ番号のみ",
    "ヘッダー情報のみ"
  ]
}
```

### OCR設定
```json
{
  "ocrEngine": "tesseract",
  "language": "jpn",
  "confidence": 80
}
```

## ⚠️ 制約事項

- **東京都制約**: 東京都は必ず1番目（セット1）に入力する必要があります
- **年月形式**: YYMM形式（4桁）での入力が必須です
- **最大自治体数**: 同時に処理できる自治体は最大5か所です
- **ファイル形式**: PDFファイルのみ対応

## 🐛 エラーハンドリング

### よくあるエラー

1. **東京都位置エラー**
   ```
   エラー: 東京都は1番目に入力してください
   ```

2. **年月形式エラー**
   ```
   エラー: YYMM形式で入力してください（例: 2506）
   ```

3. **書類判定エラー**
   ```
   警告: 複数の書類種別に該当します。手動で確認してください。
   ```

## 📊 処理レポート

システムは以下の情報を含む処理レポートを生成します：

- リネーム前後のファイル名対応表
- 空白ページ除外結果
- 書類判定結果
- エラー・警告一覧

## 🤝 コントリビューション

1. このリポジトリをフォーク
2. フィーチャーブランチを作成 (`git checkout -b feature/new-feature`)
3. 変更をコミット (`git commit -am 'Add new feature'`)
4. ブランチにプッシュ (`git push origin feature/new-feature`)
5. プルリクエストを作成

## 📋 TODO

- [ ] 新しい書類種別の追加対応
- [ ] 判定キーワードの設定UI
- [ ] バッチ処理機能
- [ ] API連携機能
- [ ] クラウドストレージ対応

## 📄 ライセンス

このプロジェクトは [MIT License](LICENSE) の下で公開されています。

## 📞 サポート

- 問題報告: [Issues](https://github.com/Earrk213/tax-doc-renamer/issues)
- 機能要望: [Discussions](https://github.com/Earrk213/tax-doc-renamer/discussions)
- ドキュメント: [Wiki](https://github.com/Earrk213/tax-doc-renamer/wiki)

---

**注意**: このシステムは税務書類の処理を支援するツールです。最終的な書類の内容確認と責任は利用者にあります。