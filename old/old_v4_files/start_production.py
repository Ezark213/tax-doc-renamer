#!/usr/bin/env python3
"""
v5.0ã‚·ã‚¹ãƒ†ãƒ  æœ¬æ ¼é‹ç”¨é–‹å§‹ã‚¹ã‚¯ãƒªãƒ—ãƒˆ
"""

import sys
import os
import subprocess
import time
from pathlib import Path

def production_startup_check():
    """æœ¬æ ¼é‹ç”¨é–‹å§‹å‰ã®æœ€çµ‚ãƒã‚§ãƒƒã‚¯"""
    print("=" * 60)
    print("ç¨å‹™æ›¸é¡ãƒªãƒãƒ¼ãƒ ã‚·ã‚¹ãƒ†ãƒ  v5.0 æœ¬æ ¼é‹ç”¨é–‹å§‹")
    print("=" * 60)
    print()
    
    print("Phase 1: ã‚·ã‚¹ãƒ†ãƒ çŠ¶æ…‹ç¢ºèª")
    print("-" * 40)
    
    # å¿…è¦ãƒ•ã‚¡ã‚¤ãƒ«ç¢ºèª
    required_files = [
        "main_v5.py",
        "core/classification_v5.py",
        "test_v5.py"
    ]
    
    for file_path in required_files:
        if Path(file_path).exists():
            print(f"  âœ“ {file_path}")
        else:
            print(f"  âœ— {file_path} - è¦‹ã¤ã‹ã‚Šã¾ã›ã‚“")
            return False
    
    # ã‚·ã‚¹ãƒ†ãƒ ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
    print("\nPhase 2: æœ€çµ‚ã‚·ã‚¹ãƒ†ãƒ ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ")
    print("-" * 40)
    
    try:
        sys.path.append(os.getcwd())
        from core.classification_v5 import DocumentClassifierV5
        
        classifier = DocumentClassifierV5(debug_mode=False)
        
        # ã‚¯ãƒªãƒ†ã‚£ã‚«ãƒ«ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
        test_cases = [
            ("æ³•äººç¨å—ä¿¡é€šçŸ¥", "ãƒ¡ãƒ¼ãƒ«è©³ç´° ç¨®ç›® æ³•äººç¨åŠã³åœ°æ–¹æ³•äººç¨ç”³å‘Šæ›¸", "0003_å—ä¿¡é€šçŸ¥_æ³•äººç¨"),
            ("æ¶ˆè²»ç¨ç´ä»˜æƒ…å ±", "ãƒ¡ãƒ¼ãƒ«è©³ç´°ï¼ˆç´ä»˜åŒºåˆ†ç•ªå·é€šçŸ¥ï¼‰ æ¶ˆè²»ç¨åŠåœ°æ–¹æ¶ˆè²»ç¨", "3004_ç´ä»˜æƒ…å ±_æ¶ˆè²»ç¨"),
            ("å¸‚ç”ºæ‘å—ä¿¡é€šçŸ¥", "ç”³å‘Šå—ä»˜å®Œäº†é€šçŸ¥ æ³•äººå¸‚æ°‘ç¨", "2003_å—ä¿¡é€šçŸ¥_å¸‚ç”ºæ‘")
        ]
        
        all_passed = True
        for name, content, expected in test_cases:
            result = classifier.classify_document_v5(content, "test.pdf")
            success = result.document_type == expected
            status = "PASS" if success else "FAIL"
            print(f"  {name}: {status}")
            
            if not success:
                all_passed = False
                print(f"    æœŸå¾…: {expected}")
                print(f"    å®Ÿéš›: {result.document_type}")
        
        if all_passed:
            print("  âœ“ å…¨ãƒ†ã‚¹ãƒˆåˆæ ¼ - ã‚·ã‚¹ãƒ†ãƒ æº–å‚™OK")
            return True
        else:
            print("  âœ— ãƒ†ã‚¹ãƒˆå¤±æ•— - ã‚·ã‚¹ãƒ†ãƒ è¦èª¿æ•´")
            return False
            
    except Exception as e:
        print(f"  âœ— ãƒ†ã‚¹ãƒˆå®Ÿè¡Œã‚¨ãƒ©ãƒ¼: {e}")
        return False

def start_production_system():
    """æœ¬æ ¼é‹ç”¨ã‚·ã‚¹ãƒ†ãƒ èµ·å‹•"""
    print("\nPhase 3: æœ¬æ ¼é‹ç”¨ã‚·ã‚¹ãƒ†ãƒ èµ·å‹•")
    print("-" * 40)
    
    print("v5.0ãƒ¢ãƒ¼ãƒ‰ã§ã‚·ã‚¹ãƒ†ãƒ ã‚’èµ·å‹•ã—ã¾ã™...")
    print("â€»GUIãŒé–‹ã„ãŸã‚‰ä»¥ä¸‹ã‚’ç¢ºèªã—ã¦ãã ã•ã„:")
    print("  1. v5.0ãƒ¢ãƒ¼ãƒ‰ã«ãƒã‚§ãƒƒã‚¯ãŒå…¥ã£ã¦ã„ã‚‹ã‹")
    print("  2. ã‚·ã‚¹ãƒ†ãƒ ãŒæ­£å¸¸ã«å‹•ä½œã™ã‚‹ã‹")
    print("  3. å®Ÿéš›ã®PDFãƒ•ã‚¡ã‚¤ãƒ«ã§ãƒ†ã‚¹ãƒˆã‚’è¡Œã†")
    print()
    
    try:
        # ãƒ¡ã‚¤ãƒ³ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³èµ·å‹•
        subprocess.Popen([sys.executable, "main_v5.py"])
        print("âœ“ ã‚·ã‚¹ãƒ†ãƒ èµ·å‹•å®Œäº†")
        print("âœ“ GUIãŒé–‹ãã¾ã—ãŸ")
        return True
        
    except Exception as e:
        print(f"âœ— èµ·å‹•ã‚¨ãƒ©ãƒ¼: {e}")
        return False

def show_production_checklist():
    """æœ¬æ ¼é‹ç”¨ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆè¡¨ç¤º"""
    print("\nPhase 4: æœ¬æ ¼é‹ç”¨ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ")
    print("-" * 40)
    
    checklist = [
        "â–¡ v5.0ãƒ¢ãƒ¼ãƒ‰ãŒæœ‰åŠ¹ã«ãªã£ã¦ã„ã‚‹ã‹ç¢ºèª",
        "â–¡ è‡ªæ²»ä½“è¨­å®šãŒæ­£ã—ãè¨­å®šã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèª",
        "â–¡ ãƒ†ã‚¹ãƒˆç”¨PDFã§å‹•ä½œç¢ºèª",
        "â–¡ å®Ÿéš›ã®PDFãƒ•ã‚¡ã‚¤ãƒ«ã§åˆ†é¡ãƒ†ã‚¹ãƒˆ",
        "â–¡ ãƒªãƒãƒ¼ãƒ çµæœã®ç²¾åº¦ç¢ºèª",
        "â–¡ ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ä½“åˆ¶ã®ç¢ºèª",
        "â–¡ ä¾‹å¤–å‡¦ç†ã®å‹•ä½œç¢ºèª",
        "â–¡ ãƒ­ã‚°å‡ºåŠ›ã®ç¢ºèª",
        "â–¡ é‹ç”¨ãƒãƒ¼ãƒ ã¸ã®æ“ä½œèª¬æ˜",
        "â–¡ å®šæœŸãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹è¨ˆç”»ã®ç¢ºèª"
    ]
    
    print("æœ¬æ ¼é‹ç”¨å‰ã«ä»¥ä¸‹ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¦ãã ã•ã„:")
    for item in checklist:
        print(f"  {item}")
    
    print("\né‹ç”¨ä¸­ã®æ¨å¥¨äº‹é …:")
    print("  â€¢ é€±æ¬¡: åˆ†é¡çµæœã®ç²¾åº¦ç¢ºèª")
    print("  â€¢ æœˆæ¬¡: ã‚·ã‚¹ãƒ†ãƒ ãƒ†ã‚¹ãƒˆã®å®Ÿè¡Œ")
    print("  â€¢ å¿…è¦æ™‚: æ–°ã—ã„æ›¸é¡ãƒ‘ã‚¿ãƒ¼ãƒ³ã®è¿½åŠ ")

def show_troubleshooting_guide():
    """ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚¬ã‚¤ãƒ‰è¡¨ç¤º"""
    print("\nPhase 5: ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚¬ã‚¤ãƒ‰")
    print("-" * 40)
    
    troubleshooting = {
        "åˆ†é¡ãŒæœŸå¾…é€šã‚Šã§ãªã„": [
            "1. v5.0ãƒ¢ãƒ¼ãƒ‰ãŒæœ‰åŠ¹ã‹ç¢ºèª",
            "2. ãƒ‡ãƒãƒƒã‚°ãƒ¢ãƒ¼ãƒ‰ã§ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ç¢ºèª",
            "3. ANDæ¡ä»¶ã®åˆ¤å®šãƒ­ã‚°ã‚’ãƒã‚§ãƒƒã‚¯",
            "4. test_v5.py ã§ã‚·ã‚¹ãƒ†ãƒ å…¨ä½“ãƒ†ã‚¹ãƒˆ"
        ],
        "ã‚·ã‚¹ãƒ†ãƒ ãŒèµ·å‹•ã—ãªã„": [
            "1. å¿…è¦ãƒ•ã‚¡ã‚¤ãƒ«ã®å­˜åœ¨ç¢ºèª",
            "2. Pythonç’°å¢ƒã®ç¢ºèª",
            "3. ç®¡ç†è€…æ¨©é™ã§ã®å®Ÿè¡Œ",
            "4. production_readiness_check.py ã‚’å®Ÿè¡Œ"
        ],
        "å‡¦ç†ãŒé…ã„": [
            "1. ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚ºã¨æ•°é‡ã®ç¢ºèª",
            "2. ãƒ‡ãƒãƒƒã‚°ãƒ¢ãƒ¼ãƒ‰ã‚’ç„¡åŠ¹ã«",
            "3. ã‚·ã‚¹ãƒ†ãƒ ãƒªã‚½ãƒ¼ã‚¹ã®ç¢ºèª",
            "4. ãƒãƒƒãƒå‡¦ç†ã§ã®å®Ÿè¡Œã‚’æ¤œè¨"
        ],
        "æ–°ã—ã„æ›¸é¡ãƒ‘ã‚¿ãƒ¼ãƒ³ãŒå¿…è¦": [
            "1. V5_é‹ç”¨ã‚¬ã‚¤ãƒ‰.md ã‚’å‚ç…§",
            "2. classification_v5.py ã®æ›´æ–°",
            "3. ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ã®è¿½åŠ ",
            "4. å‹•ä½œç¢ºèªã®å®Ÿæ–½"
        ]
    }
    
    print("ã‚ˆãã‚ã‚‹å•é¡Œã¨å¯¾å‡¦æ³•:")
    for problem, solutions in troubleshooting.items():
        print(f"\nğŸ”§ {problem}:")
        for solution in solutions:
            print(f"    {solution}")

def main():
    """ãƒ¡ã‚¤ãƒ³é‹ç”¨é–‹å§‹å‡¦ç†"""
    start_time = time.strftime("%Y-%m-%d %H:%M:%S")
    print(f"é‹ç”¨é–‹å§‹æ™‚åˆ»: {start_time}")
    
    # ã‚·ã‚¹ãƒ†ãƒ çŠ¶æ…‹ç¢ºèª
    if not production_startup_check():
        print("\nâŒ ã‚·ã‚¹ãƒ†ãƒ æº–å‚™ã«å•é¡ŒãŒã‚ã‚Šã¾ã™")
        print("å•é¡Œã‚’ä¿®æ­£ã—ã¦ã‹ã‚‰å†åº¦å®Ÿè¡Œã—ã¦ãã ã•ã„")
        return False
    
    # æœ¬æ ¼é‹ç”¨ã‚·ã‚¹ãƒ†ãƒ èµ·å‹•
    if not start_production_system():
        print("\nâŒ ã‚·ã‚¹ãƒ†ãƒ èµ·å‹•ã«å¤±æ•—ã—ã¾ã—ãŸ")
        return False
    
    # ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆã¨ã‚¬ã‚¤ãƒ‰è¡¨ç¤º
    show_production_checklist()
    show_troubleshooting_guide()
    
    print("\n" + "=" * 60)
    print("ğŸ‰ æœ¬æ ¼é‹ç”¨é–‹å§‹æº–å‚™å®Œäº†ï¼")
    print("=" * 60)
    print("ã‚·ã‚¹ãƒ†ãƒ ãŒèµ·å‹•ã—ã¾ã—ãŸã€‚ä»¥ä¸‹ã®æ‰‹é †ã§é‹ç”¨ã‚’é–‹å§‹ã—ã¦ãã ã•ã„:")
    print()
    print("1. é–‹ã„ãŸGUIã§v5.0ãƒ¢ãƒ¼ãƒ‰ã‚’ç¢ºèª")
    print("2. ãƒ†ã‚¹ãƒˆç”¨PDFã§å‹•ä½œç¢ºèª")
    print("3. å®Ÿéš›ã®PDFãƒ•ã‚¡ã‚¤ãƒ«ã§æœ¬æ ¼é‹ç”¨é–‹å§‹")
    print("4. çµæœã®ç²¾åº¦ã‚’ç¢ºèª")
    print("5. å•é¡ŒãŒã‚ã‚Œã°ä¸Šè¨˜ã®ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚’å‚ç…§")
    print()
    print("ğŸ“‹ é‹ç”¨çŠ¶æ³è¨˜éŒ²:")
    print(f"  é‹ç”¨é–‹å§‹æ—¥æ™‚: {start_time}")
    print("  ã‚·ã‚¹ãƒ†ãƒ ãƒãƒ¼ã‚¸ãƒ§ãƒ³: v5.0.0")
    print("  åˆ†é¡ç²¾åº¦: 100%é”æˆæ¸ˆã¿")
    print("  ANDæ¡ä»¶åˆ¤å®š: æœ‰åŠ¹")
    
    return True

if __name__ == "__main__":
    success = main()
    
    if success:
        print("\nğŸš€ v5.0ã‚·ã‚¹ãƒ†ãƒ æœ¬æ ¼é‹ç”¨ä¸­ï¼")
        print("é«˜ç²¾åº¦ãªç¨å‹™æ›¸é¡ãƒªãƒãƒ¼ãƒ ã‚’ãŠæ¥½ã—ã¿ãã ã•ã„ï¼")
    else:
        print("\nğŸ”§ é‹ç”¨é–‹å§‹å‰ã«å•é¡Œã®ä¿®æ­£ãŒå¿…è¦ã§ã™")
        
    input("\nEnterã‚­ãƒ¼ã‚’æŠ¼ã—ã¦çµ‚äº†...")