# Tax Document Renamer - Development Requirements v3.1

## 開発方針
- 基本的に、修正点と現状を修正の都度ドキュメント化し、修正後に要求される機能をゼロベースで構築すること
- GitHub上でドキュメント化 → 生成の流れで効率化を図る

## 現在の問題点

### 1. YYMM判定の優先順位問題 ❌
**問題**: 末尾のYYMMが必ず入力したYYMMに変更されるべきところ、画像認識が優先されている
**要求**: 
- ユーザー入力のYYMMを最優先とする
- 画像認識のYYMMは補完的な機能に留める

### 2. CSVファイル読み込み未対応 ❌
**問題**: CSVファイルが読み込めていない
**要求**:
- CSVファイルの読み込み機能を実装
- PDFの仕訳帳: `5005_仕訳帳_YYMM`
- CSVの仕訳帳: `5006_仕訳帳_YYMM`

### 3. ドラッグアンドドロップ機能なし ❌
**問題**: ファイル選択がボタンクリックのみ
**要求**: ドラッグアンドドロップ機能を追加

### 4. デバッグ機能不足 ❌
**問題**: 開発者用デバッグログが不十分
**要求**: 
- 豊富なデバッグログ機能
- アプリ上部にタブ方式を採用
- タブ例: ファイル選択、出力、デバッグ

### 5. 税区分集計表の区別 ❌
**問題**: 2種類の税区分集計表が区別されていない
**要求**:
- 勘定科目別税区分集計表 → `7001_勘定科目別税区分集計表_YYMM`
- 税区分集計表 → `7002_税区分集計表_YYMM`

## 新機能要件

### UI設計
- タブ形式のインターフェース
  - タブ1: ファイル選択
  - タブ2: 出力設定
  - タブ3: デバッグログ

### ファイル処理
- PDFファイル対応（既存）
- CSVファイル対応（新規）
- ドラッグアンドドロップ対応（新規）

### 命名ルール強化
```
PDFファイル:
- 仕訳帳: 5005_仕訳帳_YYMM
- 勘定科目別税区分集計表: 7001_勘定科目別税区分集計表_YYMM
- 税区分集計表: 7002_税区分集計表_YYMM

CSVファイル:
- 仕訳帳: 5006_仕訳帳_YYMM
```

### 優先順位
1. ユーザー入力YYMM（最優先）
2. ファイル名からの推定
3. OCR画像認識（補完的）

### デバッグ機能
- 処理ステップの詳細ログ
- OCR認識結果の表示
- ファイル名決定プロセスの可視化
- エラー詳細情報

## 実装順序
1. 現状分析とドキュメント化 ✅
2. YYMM優先順位修正
3. CSV読み込み機能
4. タブ形式UI実装
5. ドラッグアンドドロップ機能
6. デバッグログ機能
7. 税区分集計表区別機能
8. 統合テスト

## 技術スタック
- Python 3.12
- tkinter (GUI)
- PyPDF2/PyMuPDF (PDF処理)
- pandas (CSV処理)
- pytesseract (OCR)
- Pillow (画像処理)

## 成果物
- 新しい実行可能ファイル
- 詳細な開発ドキュメント
- ユーザーマニュアル
- テストケース